p8105_hw2_ns3782
================
NSK
2024-09-26

true

# Problem 1

``` r
## Read and clean NYC transit data

nyc_transit_df = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  select(line, station_name, station_latitude, station_longitude, route1:route11, entry, vending, entrance_type, ada) %>%
  mutate(entry = case_match(
    entry,
    "YES" ~ TRUE,
    "NO" ~ FALSE,
    .default = NA
  ))
```

    ## Rows: 1868 Columns: 32
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (22): Division, Line, Station Name, Route1, Route2, Route3, Route4, Rout...
    ## dbl  (8): Station Latitude, Station Longitude, Route8, Route9, Route10, Rout...
    ## lgl  (2): ADA, Free Crossover
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Dataset overview

The cleaned NYC Transit Subway Entrance and Exit dataset contains
information about entrances and exits of subway stations in New York
City. Variables selected for inclusion in the cleaned dataset imported
into R include the line, station name, location coordinates (latitude
and longitude), routes served (route 1 through to route 11), entry,
vending presence, entrance type, and ADA compliance.

The data cleaning process involved reading the CSV file from a local
subdirectory /data, cleaning variable names using the janitor package,
selecting variables of interest, and converting the ‘entry’ variable
from character (“YES”/“NO”) to logical (TRUE/FALSE).

The resulting dataset has **1868 rows** and **19 columns**. The dataset
is not tidy because information about routes served is spread across
multiple columns (Route1 through Route11). This does not align with good
tidy data practice, as each variable should form a column and each
observation should form a row.

## How many distinct stations are there?

``` r
nyc_transit_df %>%
  distinct(station_name, line) %>%
  nrow()
```

    ## [1] 465

There are 465 distinct subway stations in the NYC transit subway system.

## How many stations are ADA compliant?

``` r
nyc_transit_df %>%
  filter(ada == TRUE) %>%
  distinct(station_name, line) %>%
  nrow()
```

    ## [1] 84

There are 84 ADA compliant stations.

## What proportion of station entrances / exits without vending allow entrance?

``` r
prop_no_vending_entry <- nyc_transit_df %>%
  filter(vending == "NO") %>%
  summarise(prop = mean(entry, na.rm = TRUE)) %>%
  pull(prop)
```

The proportion of station entrances/exits without vending that allow
entrance is 0.3770492, or 37.7%.

# Problem 2

``` r
## Read and clean Mr. Trash Wheel sheet

mr_trash_wheel_df <- read_excel(
  "./data/trash_wheel_collection_data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = cell_cols("A:N"),
  skip = 1
) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr. Trash Wheel",
    year = as.numeric(year)
  )

## Read and clean Professor Trash Wheel sheet
prof_trash_wheel_df <- read_excel(
  "./data/trash_wheel_collection_data.xlsx",
  sheet = "Professor Trash Wheel",
  range = cell_cols("A:M"),
  skip = 1
) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    trash_wheel = "Professor Trash Wheel",
    year = as.numeric(year)
  )

## Read and clean Gwynnda Wheel sheet

gwynnda_trash_wheel_df <- read_excel(
  "./data/trash_wheel_collection_data.xlsx",
  sheet = "Gwynnda Trash Wheel",
  range = cell_cols("A:L"),
  skip = 1
) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    trash_wheel = "Gwynnda Trash Wheel",
    year = as.numeric(year)
  )


## Combine all trash wheel datasets
combined_trash_wheel <- bind_rows(
  mr_trash_wheel_df, 
  prof_trash_wheel_df, 
  gwynnda_trash_wheel_df
) %>%
  select(trash_wheel, everything())

# Total weight collected by Prof Trash Wheel
prof_total_weight <- prof_trash_wheel_df %>%
  summarize(total_weight = sum(weight_tons)) %>%
  pull(total_weight)

# Total cigarette butts collected by Gwynnda June 2022
gwynnda_june_2022_butts <- gwynnda_trash_wheel_df %>%
  filter(month == "June", year == 2022) %>%
  summarize(total_butts = sum(cigarette_butts)) %>%
  pull(total_butts)
```

## Combined trash wheel Dataset Overview

The combined Trash Wheel dataset contains 845 observations and 15
variables. Key variables include the identifier for each trash wheel
(Mr. Trash Wheel, Professor Trash Wheel, Gwynnda Trash Wheel), the date
of collection, the amount of trash collected (in tons and cubic yards),
types of litter collected (e.g., plastic bottles, polystyrene, cigarette
butts), and number of homes powered based on trash collected.

The data shows that Professor Trash Wheel has collected a total of
216.26 tons of trash since its deployment. In June 2022, Gwynnda Trash
Wheel collected 18,120 cigarette butts.

# Problem 3

## Importing and Cleaning datasets.

``` r
# Import and clean results csv

results_df <- read_csv("./data/results.csv", skip = 2) %>% 
  janitor::clean_names() %>%
  rename(baker_first_name = baker)
```

    ## Rows: 1136 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (2): baker, result
    ## dbl (3): series, episode, technical
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Import and clean results bakers csv

bakers_df <- read_csv("./data/bakers.csv") %>% 
  janitor::clean_names() %>%
  separate(baker_name, into = c("baker_first_name", "baker_last_name"), sep = " ", extra = "merge")
```

    ## Rows: 120 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (3): Baker Name, Baker Occupation, Hometown
    ## dbl (2): Series, Baker Age
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Import and clean results bakes csv

bakes_df <- read_csv("./data/bakes.csv") %>% 
  janitor::clean_names() %>%
  rename(baker_first_name = baker) %>%
  mutate(across(where(is.character), ~case_match(
    .,
    c("Unknown", "UNKNOWN", "N/A") ~ NA_character_,
    .default = . %>%
      str_replace_all("([a-z])([A-Z])", "\\1 \\2") %>%
      str_replace_all("(?<=[a-z])with", " with") %>%
      str_replace_all("\\s+", " ") %>%
      str_trim()
  )),
  baker_first_name = str_remove_all(baker_first_name, "\""))  # Removes the quotes from "Jo"
```

    ## Rows: 548 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (3): Baker, Signature Bake, Show Stopper
    ## dbl (2): Series, Episode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Import and clean viewers csv

viewers_df <- read_csv("./data/viewers.csv") %>% 
  janitor::clean_names()
```

    ## Rows: 10 Columns: 11
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (11): Episode, Series 1, Series 2, Series 3, Series 4, Series 5, Series ...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Pivoting viewers_df into long format

viewers_long_df <- viewers_df %>%
  pivot_longer(
    cols = starts_with("series_"),
    names_to = "series",
    values_to = "viewers",
    names_prefix = "series_"
  ) %>%
  mutate(series = as.numeric(series)) %>%
  select(series, everything())
```

## Checking for Incomplete Data

``` r
# Check for bakers without any competition data
missing_bakers <- bakers_df %>%
  anti_join(bakes_df, by = c("baker_first_name", "series"))
print(missing_bakers)
```

    ## # A tibble: 25 × 6
    ##    baker_first_name baker_last_name series baker_age baker_occupation   hometown
    ##    <chr>            <chr>            <dbl>     <dbl> <chr>              <chr>   
    ##  1 Alice            Fevronia            10        28 Geography teacher  Essex   
    ##  2 Amelia           LeBruin             10        24 Fashion designer   Halifax 
    ##  3 Antony           Amourdoux            9        30 Banker             London  
    ##  4 Briony           Williams             9        33 Full-time parent   Bristol 
    ##  5 Dan              Beasley-Harling      9        36 Full-time parent   London  
    ##  6 Dan              Chambers            10        32 Support worker     Rotherh…
    ##  7 David            Atherton            10        36 International hea… Whitby  
    ##  8 Helena           Garcia              10        40 Online project ma… Leeds   
    ##  9 Henry            Bird                10        20 Student            Durham  
    ## 10 Imelda           McCarron             9        33 Countryside recre… County …
    ## # ℹ 15 more rows

``` r
# Check for baking data without baker information
missing_bakes <- bakes_df %>%
  anti_join(bakers_df, by = c("baker_first_name", "series"))
print(missing_bakes)
```

    ## # A tibble: 0 × 5
    ## # ℹ 5 variables: series <dbl>, episode <dbl>, baker_first_name <chr>,
    ## #   signature_bake <chr>, show_stopper <chr>

## Merging and Cleaning merged data

``` r
# Merging dataframes, removing incomplete data, and filling in missing contestant last names

bakers_bake_merged_df <- bakers_df %>%
  full_join(bakes_df, by = c("baker_first_name", "series")) %>%
  full_join(results_df, by = c("baker_first_name", "series", "episode")) %>%
  full_join(viewers_long_df, by = c("series", "episode")) %>%
  select(baker_first_name, baker_last_name, series, episode, everything()) %>%
  filter(!(is.na(baker_first_name) & is.na(baker_last_name)))  %>% 
  group_by(series) %>% 
  fill(baker_last_name) %>%  
  ungroup()  
```
